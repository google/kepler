# See README regarding how to run tests.

load("//devtools/python/blaze:pytype.bzl", "pytype_strict_binary", "pytype_strict_contrib_test", "pytype_strict_library")

package(default_visibility = ["//research/sir/kepler:__subpackages__"])

pytype_strict_library(
    name = "query_utils",
    srcs = ["query_utils.py"],
    srcs_version = "PY3",
    deps = [
        "//third_party/py/absl/logging",
        "//third_party/py/psycopg2",
    ],
)

pytype_strict_library(
    name = "test_util",
    srcs = ["test_util.py"],
    srcs_version = "PY3",
    deps = [
        ":query_utils",
    ],
)

pytype_strict_contrib_test(
    name = "query_utils_test",
    srcs = ["query_utils_test.py"],
    python_version = "PY3",
    tags = [
        "notap",
    ],
    deps = [
        ":query_utils",
        ":test_util",
        "//testing/pybase",
    ],
)

pytype_strict_library(
    name = "pg_generate_plan_candidates",
    srcs = ["pg_generate_plan_candidates.py"],
    srcs_version = "PY3",
    deps = [
        ":query_utils",
        "//third_party/py/absl:app",
        "//third_party/py/absl/logging",
    ],
)

pytype_strict_contrib_test(
    name = "pg_generate_plan_candidates_test",
    srcs = ["pg_generate_plan_candidates_test.py"],
    python_version = "PY3",
    tags = [
        "manual",
        "notap",
    ],
    deps = [
        ":pg_generate_plan_candidates",
        ":query_utils",
        ":test_util",
        "//testing/pybase",
        "//testing/pybase:parameterized",
    ],
)

pytype_strict_binary(
    name = "pg_generate_plan_candidates_main",
    srcs = ["pg_generate_plan_candidates_main.py"],
    python_version = "PY3",
    srcs_version = "PY3",
    deps = [
        ":pg_generate_plan_candidates",
        ":query_utils",
        "//third_party/py/absl:app",
        "//third_party/py/absl/flags",
        "//third_party/py/absl/logging",
    ],
)

pytype_strict_library(
    name = "pg_execute_training_data_queries",
    srcs = ["pg_execute_training_data_queries.py"],
    srcs_version = "PY3",
    deps = [
        ":query_utils",
        "//third_party/py/absl:app",
        "//third_party/py/absl/logging",
    ],
)

pytype_strict_contrib_test(
    name = "pg_execute_training_data_queries_test",
    srcs = ["pg_execute_training_data_queries_test.py"],
    python_version = "PY3",
    deps = [
        ":pg_execute_training_data_queries",
        "//testing/pybase",
        "//testing/pybase:parameterized",
    ],
)

pytype_strict_binary(
    name = "pg_execute_training_data_queries_main",
    srcs = ["pg_execute_training_data_queries_main.py"],
    python_version = "PY3",
    srcs_version = "PY3",
    deps = [
        ":pg_execute_training_data_queries",
        ":query_utils",
        "//third_party/py/absl:app",
        "//third_party/py/absl/flags",
    ],
)

pytype_strict_library(
    name = "parameter_generator",
    srcs = ["parameter_generator.py"],
    srcs_version = "PY3",
    deps = [":query_utils"],
)

pytype_strict_contrib_test(
    name = "parameter_generator_test",
    srcs = ["parameter_generator_test.py"],
    python_version = "PY3",
    tags = [
        "manual",
        "notap",
    ],
    deps = [
        ":parameter_generator",
        ":query_utils",
        ":test_util",
        "//testing/pybase",
    ],
)

pytype_strict_binary(
    name = "parameter_generator_main",
    srcs = ["parameter_generator_main.py"],
    python_version = "PY3",
    srcs_version = "PY3",
    deps = [
        ":parameter_generator",
        "//third_party/py/absl:app",
        "//third_party/py/absl/flags",
    ],
)
